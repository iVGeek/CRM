{% extends "base.html" %}
{% block title %}{{ client.company_name }} - GCS CRM{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>{{ client.company_name }}</h1>
    <div>
        <a href="{{ url_for('client_edit', id=client.id) }}" class="btn btn-primary">Edit</a>
        <form action="{{ url_for('client_delete', id=client.id) }}" method="POST" class="d-inline"
              onsubmit="return confirm('Delete this client?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-danger">Delete</button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">Client Details</h5></div>
            <div class="card-body">
                <p><strong>Email:</strong> {{ client.email or '-' }}</p>
                <p><strong>Phone:</strong> {{ client.phone or '-' }}</p>
                <p><strong>Address:</strong> {{ client.address or '-' }}</p>
                <p><strong>City:</strong> {{ client.city or '-' }}</p>
                <p><strong>Country:</strong> {{ client.country or '-' }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Contacts</h5>
                <a href="{{ url_for('contact_new') }}" class="btn btn-sm btn-primary">Add Contact</a>
            </div>
            <div class="card-body">
                {% if client.contacts %}
                <ul class="list-group list-group-flush">
                    {% for contact in client.contacts %}
                    <li class="list-group-item">
                        <strong>{{ contact.name }}</strong>
                        {% if contact.position %}<small class="text-muted">({{ contact.position }})</small>{% endif %}
                        <br>
                        {% if contact.email %}<small>{{ contact.email }}</small>{% endif %}
                        {% if contact.phone %} &middot; <small>{{ contact.phone }}</small>{% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">No contacts for this client.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header"><h5 class="mb-0">Proforma Invoices</h5></div>
    <div class="card-body">
        {% if client.invoices %}
        <table class="table table-hover mb-0">
            <thead>
                <tr><th>Invoice #</th><th>Date</th><th>Total</th><th>Status</th></tr>
            </thead>
            <tbody>
                {% for inv in client.invoices %}
                <tr>
                    <td><a href="{{ url_for('invoice_detail', id=inv.id) }}">{{ inv.invoice_number }}</a></td>
                    <td>{{ inv.date_issued }}</td>
                    <td>{{ "%.2f"|format(inv.total) }}</td>
                    <td>
                        {% if inv.status == 'Draft' %}<span class="badge bg-secondary">Draft</span>
                        {% elif inv.status == 'Sent' %}<span class="badge bg-primary">Sent</span>
                        {% elif inv.status == 'Accepted' %}<span class="badge bg-success">Accepted</span>
                        {% elif inv.status == 'Rejected' %}<span class="badge bg-danger">Rejected</span>
                        {% elif inv.status == 'Expired' %}<span class="badge bg-warning">Expired</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted mb-0">No invoices for this client.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
